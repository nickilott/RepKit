---
title: "ReadQC Results"
header-includes: #allows you to add in your own Latex packages
- \usepackage{float} #use the 'float' package
- \floatplacement{figure}{H} #make every figure with caption = h

output:
  pdf_document:
    fig_caption: true
    keep_tex: true
    latex_engine: pdflatex
  html_document:
    df_print: paged
urlcolor: blue
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(out.extra = '')
#knitr::opts_chunk$set(fig.pos = 'H')
knitr::opts_knit$set(root.dir = "/gfs/work/nilott/proj018/analysis/biopsies/reports/rmarkdown1/data")
```
# Readqc Summary Report {#readqc}

This report contains an aggregated overview of the QC metrics generated by the [FastQC](http://www.bioinformatics.babraham.ac.uk/projects/fastqc/) package for each fastq file.

```{r include=FALSE, echo=FALSE}
library(ggplot2)
library(gridExtra)
library(dplyr)
source("/gfs/devel/nilott/stats_utils/R/readstats.R")
```

## Sequence quality metrics

A [Phred](https://en.wikipedia.org/wiki/Phred_quality_score) score of ~40 is expected for good quality bases. Base qualities may tail off toward the end of the read and be worse for the second read.
The plots below are output from fastqc and give an overall impression of the data quality.

```{r seq-quality, fig.cap='Various quality metrics output by FastQC', fig.height=5, fig.width=8,  echo=FALSE, message=FALSE}
# get transformed counts
# rld <- rlog(dds, blind=FALSE)

db <- "fastqc_csvdb"
samples <- getSamples("fastqc_csvdb")

df1 <- combineSampleQC(db, "Per_base_sequence_quality", samples)
df2 <- combineSampleQC(db, "Per_sequence_quality_scores", samples)
df3 <- combineSampleQC(db, "Per_sequence_GC_content", samples)
df4 <- combineSampleQC(db, "Sequence_Duplication_Levels", samples)

p1 <- plotPerBaseSequenceQuality(df1)
p2 <- plotPerSequenceQuality(df2)
p3 <- plotPerSequenceGC(df3)
p4 <- plotSequenceDuplicationLevels(df4)

grid.arrange(p1,p2,p3,p4, ncol=2, nrow=2)

```
\newpage

